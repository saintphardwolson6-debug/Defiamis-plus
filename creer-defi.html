<!doctype html>
<html lang="fr">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Cr√©er un d√©fi ‚Äî D√©fi-Amis+</title><link rel="stylesheet" href="assets/css/style.css"></head>
<body>
  <main class="page card">
    <h2>‚úçÔ∏è Cr√©er un D√©fi (VIP requis)</h2>
    <p class="muted">Seuls les VIP valid√©s peuvent cr√©er un d√©fi. Code ma√Ætre : <strong>VIP-2025</strong></p>

    <label>Ton pr√©nom (h√¥te)</label>
    <input id="hostName" placeholder="Ex : Tchoulo">

    <label>Mode</label>
    <select id="mode">
      <option value="ami">üéØ D√©fi Ami</option>
      <option value="crush">üíò Crush Challenge</option>
    </select>

    <div id="questionsArea" class="card small muted"></div>

    <div class="row">
      <button id="btnCreate" class="btn primary">Valider & G√©n√©rer UID</button>
      <button class="btn ghost" onclick="location.href='index.html'">Annuler</button>
    </div>

    <div id="created" class="created hidden"></div>
  </main>

<script type="module">
import { isVipUser, generateRoom } from './assets/js/script.js';
const hostEl = document.getElementById('hostName');
const modeEl = document.getElementById('mode');
const qArea = document.getElementById('questionsArea');
const created = document.getElementById('created');
async function renderPreview(){
  const mod = modeEl.value;
  const lists = await import('./assets/js/questions.js');
  const arr = lists.default[mod];
  qArea.innerHTML = '<p>Pr√©visualisation des questions (les r√©ponses sont d√©termin√©es par l\'h√¥te) :</p>';
  arr.forEach((q,i)=>{
    qArea.innerHTML += `<div class="quizItem"><strong>Q${i+1}:</strong> ${q.question.replace(/__NOM__/g, hostEl.value||'H√¥te')}<br>${q.options.map((o,idx)=>`<span class="opt">(${String.fromCharCode(65+idx)}) ${o}</span>`).join(' ')}</div>`;
  });
}
modeEl.onchange = renderPreview;
hostEl.oninput = renderPreview;
renderPreview();

document.getElementById('btnCreate').onclick = async ()=>{
  const host = hostEl.value.trim();
  if(!host) return alert('Entrez votre pr√©nom (h√¥te).');
  if(!isVipUser(host)) return alert('Acc√®s refus√© : vous devez √™tre VIP (utilisez le code VIP-2025 ou validation admin).');
  const mod = modeEl.value;
  const questionsModule = await import('./assets/js/questions.js');
  const source = questionsModule.default[mod];
  const questions = source.map((q)=> ({ question: q.question.replace(/__NOM__/g, host), options: q.options, answer: q.answer }) );
  const room = await generateRoom({ host, mode: mod, questions });
  created.classList.remove('hidden');
  created.innerHTML = `<p>‚úÖ D√©fi cr√©√© !</p><p><strong>UID :</strong> ${room.uid}</p><p><strong>OwnerCode :</strong> ${room.ownerCode} (conserve-le)</p>
  <p>Lien partageable : <input readonly style="width:100%" value="${location.origin + '/jouer.html?uid=' + room.uid}"></p>`;
};
</script>
</body>
</html>
